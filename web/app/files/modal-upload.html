<!-- Upload Modal with Enhanced Features -->
<div id="uploadModal" class="modal-overlay hidden">
      <div class="modal-content" style="max-width: 700px">
        <div class="flex justify-between items-center mb-6">
          <h3>Upload Files</h3>
          <button onclick="closeUploadModal()" class="btn btn-ghost btn-sm">
            ‚úï
          </button>
        </div>

        <!-- Upload Zone -->
        <div id="uploadZone" class="upload-zone">
          <div class="upload-icon">üì§</div>
          <h3>Drag & Drop Files Here</h3>
          <p>or click to browse</p>
          <input
            type="file"
            class="upload-input"
            multiple
            accept="image/*,video/*,audio/*,.pdf,.txt,.doc,.docx"
          />
          <div class="upload-info">
            <small>Max file size: 100 MB</small>
            <small>Supported: Images, Videos, Audio, Documents</small>
          </div>
        </div>

        <!-- Upload Summary -->
        <div id="uploadSummary" class="hidden mt-6">
          <!-- Summary will be rendered here -->
        </div>

        <!-- Upload Queue -->
        <div id="uploadQueue" class="mt-6">
          <!-- Queue items will be rendered here -->
        </div>

        <!-- Upload Actions -->
        <div id="uploadActions" class="flex justify-end gap-3 mt-6">
          <button class="btn btn-ghost" onclick="closeUploadModal()">
            Cancel
          </button>
          <button class="btn btn-ghost" onclick="clearQueue()">
            Clear All
          </button>
          <button class="btn btn-primary" onclick="startUpload()">
            <span>Start Upload</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    .upload-area {
      border: 2px dashed var(--gray-300);
      border-radius: var(--radius-lg);
      padding: var(--space-12) var(--space-8);
      text-align: center;
      transition: all var(--transition-fast);
      background: var(--bg-secondary);
      cursor: pointer;
    }

    .upload-area:hover,
    .upload-area.drag-over {
      border-color: var(--primary-color);
      background: var(--primary-light);
    }

    .upload-area.drag-over {
      transform: scale(1.02);
    }

    .upload-content {
      pointer-events: none;
    }

    .upload-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      background: var(--white);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
    }

    .upload-item .file-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: white;
    }

    .upload-item .file-info {
      flex: 1;
      min-width: 0;
    }

    .upload-item .file-name {
      font-weight: 500;
      color: var(--gray-900);
      margin-bottom: var(--space-1);
      word-break: break-word;
    }

    .upload-item .file-meta {
      font-size: 0.75rem;
      color: var(--gray-500);
      margin: 0;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: var(--gray-200);
      border-radius: 2px;
      overflow: hidden;
      margin-top: var(--space-2);
    }

    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    .queue-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-2) var(--space-3);
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
    }

    .space-y-2 > * + * {
      margin-top: var(--space-2);
    }
    .space-y-3 > * + * {
      margin-top: var(--space-3);
    }
    .ml-2 {
      margin-left: var(--space-2);
    }
  </style>

  <script>
    let uploadQueue = [];
    let isUploading = false;

    function closeUploadModal() {
      const modal = document.getElementById("uploadModal");
      if (modal) {
        modal.classList.add("hidden");
        clearQueue();
      }
    }

    function handleDragOver(e) {
      e.preventDefault();
      document.getElementById("uploadArea").classList.add("drag-over");
    }

    function handleDragLeave(e) {
      e.preventDefault();
      document.getElementById("uploadArea").classList.remove("drag-over");
    }

    function handleDrop(e) {
      e.preventDefault();
      document.getElementById("uploadArea").classList.remove("drag-over");

      const files = Array.from(e.dataTransfer.files);
      addFilesToQueue(files);
    }

    function handleFileSelect(e) {
      const files = Array.from(e.target.files);
      addFilesToQueue(files);
    }

    function addFilesToQueue(files) {
      files.forEach((file) => {
        if (file.size > 100 * 1024 * 1024) {
          // 100MB limit
          alert(`File "${file.name}" is too large. Maximum size is 100MB.`);
          return;
        }

        uploadQueue.push({
          id: Date.now() + Math.random(),
          file: file,
          status: "pending",
        });
      });

      updateQueueDisplay();
    }

    function updateQueueDisplay() {
      const queueDiv = document.getElementById("uploadQueue");
      const queueList = document.getElementById("queueList");
      const queueCount = document.getElementById("queueCount");
      const uploadActions = document.getElementById("uploadActions");

      if (uploadQueue.length > 0) {
        queueDiv.classList.remove("hidden");
        uploadActions.classList.add("hidden");

        queueList.innerHTML = uploadQueue
          .map(
            (item) => `
            <div class="queue-item">
                <div class="file-icon" style="background: ${getFileColor(
                  item.file.name
                )};">
                    ${getFileIcon(item.file.name)}
                </div>
                <div class="file-info" style="flex: 1;">
                    <p class="file-name">${item.file.name}</p>
                    <p class="file-meta">${formatFileSize(item.file.size)}</p>
                </div>
                <button class="btn btn-ghost btn-sm" onclick="removeFromQueue('${
                  item.id
                }')">‚úï</button>
            </div>
        `
          )
          .join("");

        queueCount.textContent = uploadQueue.length;
      } else {
        queueDiv.classList.add("hidden");
        uploadActions.classList.remove("hidden");
      }
    }

    function removeFromQueue(id) {
      uploadQueue = uploadQueue.filter((item) => item.id !== id);
      updateQueueDisplay();
    }

    function clearQueue() {
      uploadQueue = [];
      updateQueueDisplay();
      document.getElementById("uploadProgress").classList.add("hidden");
    }

    function startUpload() {
      if (uploadQueue.length === 0 || isUploading) return;

      isUploading = true;
      document.getElementById("uploadQueue").classList.add("hidden");
      document.getElementById("uploadProgress").classList.remove("hidden");

      const uploadList = document.getElementById("uploadList");
      uploadList.innerHTML = "";

      uploadQueue.forEach((item, index) => {
        const uploadItem = document.createElement("div");
        uploadItem.className = "upload-item";
        uploadItem.innerHTML = `
            <div class="file-icon" style="background: ${getFileColor(
              item.file.name
            )};">
                ${getFileIcon(item.file.name)}
            </div>
            <div class="file-info">
                <p class="file-name">${item.file.name}</p>
                <p class="file-meta">${formatFileSize(item.file.size)}</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-${
                      item.id
                    }" style="width: 0%;"></div>
                </div>
            </div>
            <div id="status-${
              item.id
            }" class="text-sm text-muted">Waiting...</div>
        `;
        uploadList.appendChild(uploadItem);

        // Simulate upload progress
        setTimeout(() => simulateUpload(item.id, index), index * 500);
      });
    }

    function simulateUpload(itemId, index) {
      const progressBar = document.getElementById(`progress-${itemId}`);
      const statusDiv = document.getElementById(`status-${itemId}`);

      let progress = 0;
      statusDiv.textContent = "Uploading...";

      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          progressBar.style.width = "100%";
          statusDiv.textContent = "Complete ‚úì";
          statusDiv.style.color = "var(--success)";
          clearInterval(interval);

          // Check if all uploads are complete
          if (
            document.querySelectorAll("#uploadList .upload-item").length ===
            document.querySelectorAll(
              '#uploadList [id^="status-"]:contains("Complete")'
            ).length
          ) {
            setTimeout(() => {
              isUploading = false;
              closeUploadModal();
            }, 1000);
          }
        } else {
          progressBar.style.width = progress + "%";
        }
      }, 200);
    }

    function getFileIcon(filename) {
      const ext = filename.split(".").pop().toLowerCase();
      switch (ext) {
        case "pdf":
          return "üìÑ";
        case "jpg":
        case "jpeg":
        case "png":
        case "gif":
        case "webp":
          return "üñºÔ∏è";
        case "mp4":
        case "avi":
        case "mov":
        case "wmv":
          return "üé•";
        case "mp3":
        case "wav":
        case "flac":
          return "üéµ";
        case "doc":
        case "docx":
          return "üìù";
        case "xls":
        case "xlsx":
          return "üìä";
        case "ppt":
        case "pptx":
          return "üìã";
        case "zip":
        case "rar":
          return "üóúÔ∏è";
        default:
          return "üìÑ";
      }
    }

    function getFileColor(filename) {
      const ext = filename.split(".").pop().toLowerCase();
      switch (ext) {
        case "pdf":
          return "#FF5252";
        case "jpg":
        case "jpeg":
        case "png":
        case "gif":
        case "webp":
          return "#4CAF50";
        case "mp4":
        case "avi":
        case "mov":
        case "wmv":
          return "#2196F3";
        case "mp3":
        case "wav":
        case "flac":
          return "#9C27B0";
        case "doc":
        case "docx":
          return "#2196F3";
        case "xls":
        case "xlsx":
          return "#FF9800";
        case "ppt":
        case "pptx":
          return "#FF5722";
        case "zip":
        case "rar":
          return "#795548";
        default:
          return "#9E9E9E";
      }
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return "0 Bytes";
      const k = 1024;
      const sizes = ["Bytes", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
    }

    // Close modal on overlay click
    document
      .getElementById("uploadModal")
      .addEventListener("click", function (e) {
        if (e.target === this) {
          closeUploadModal();
        }
      });

    // Make upload area clickable
    document
      .getElementById("uploadArea")
      .addEventListener("click", function () {
        document.getElementById("fileInput").click();
      });
  </script>
</div>
