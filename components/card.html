<div class="media-card glass-card h-100" data-file-id="{{id}}">
  <div class="card-thumbnail">
    <div class="thumbnail-container">
      <img
        src="{{thumbnail}}"
        alt="{{title}}"
        class="thumbnail-image"
        onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPnt7dHlwZX19PC90ZXh0Pjwvc3ZnPg=='"
        loading="lazy"
      />
      <div class="thumbnail-overlay">
        <div class="play-button">
          <i class="fas fa-play"></i>
        </div>
        <div class="duration-badge">{{duration}}</div>
      </div>
    </div>
  </div>

  <div class="card-body">
    <div class="card-header-info">
      <h5 class="card-title">{{title}}</h5>
      <div class="card-meta">
        <small class="text-muted">
          <i class="fas fa-calendar-alt me-1"></i>
          {{date}}
        </small>
        <small class="text-muted ms-2">
          <i class="fas fa-eye me-1"></i>
          {{views}}
        </small>
      </div>
    </div>

    <div class="card-content">
      <p class="card-description">{{description}}</p>

      <div class="card-tags">
        {{#tags}}
        <span class="badge bg-primary bg-opacity-20 text-primary">{{.}}</span>
        {{/tags}}
      </div>
    </div>

    <div class="card-footer">
      <div class="card-actions">
        <button
          class="btn btn-outline-primary btn-sm"
          onclick="viewFile('{{id}}')"
        >
          <i class="fas fa-eye me-1"></i>
          Visualizar
        </button>
        <div class="dropdown">
          <button
            class="btn btn-outline-secondary btn-sm dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
          >
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <ul class="dropdown-menu">
            <li>
              <a
                class="dropdown-item"
                href="#"
                onclick="addToPlaylist('{{id}}')"
              >
                <i class="fas fa-plus me-2"></i>Adicionar à Playlist
              </a>
            </li>
            <li>
              <a
                class="dropdown-item"
                href="#"
                onclick="downloadFile('{{id}}')"
              >
                <i class="fas fa-download me-2"></i>Download
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="shareFile('{{id}}')">
                <i class="fas fa-share me-2"></i>Compartilhar
              </a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a
                class="dropdown-item text-danger"
                href="#"
                onclick="deleteFile('{{id}}')"
              >
                <i class="fas fa-trash me-2"></i>Excluir
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="card-info">
        <small class="text-muted">
          <i class="fas fa-hdd me-1"></i>
          {{size}}
        </small>
        <small class="text-muted ms-2">
          <i class="fas fa-film me-1"></i>
          {{quality}}
        </small>
      </div>
    </div>
  </div>
</div>

<style>
  .media-card {
    transition: all 0.3s ease;
    cursor: pointer;
    border: 1px solid rgba(var(--bs-primary-rgb), 0.1);
  }

  .media-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .card-thumbnail {
    position: relative;
    overflow: hidden;
    border-radius: 0.5rem 0.5rem 0 0;
  }

  .thumbnail-container {
    position: relative;
    width: 100%;
    height: 180px;
    overflow: hidden;
  }

  .thumbnail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .media-card:hover .thumbnail-image {
    transform: scale(1.05);
  }

  .thumbnail-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.1),
      rgba(0, 0, 0, 0.3)
    );
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .media-card:hover .thumbnail-overlay {
    opacity: 1;
  }

  .play-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(var(--bs-primary-rgb), 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    transition: all 0.3s ease;
  }

  .play-button:hover {
    transform: scale(1.1);
    background: rgba(var(--bs-primary-rgb), 1);
  }

  .duration-badge {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .card-body {
    padding: 1rem;
  }

  .card-header-info {
    margin-bottom: 0.75rem;
  }

  .card-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-meta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .card-content {
    margin-bottom: 1rem;
  }

  .card-description {
    font-size: 0.875rem;
    color: var(--bs-secondary);
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.4;
  }

  .card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-bottom: 0.75rem;
  }

  .card-tags .badge {
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(var(--bs-primary-rgb), 0.1);
  }

  .card-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .card-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .card-info small {
    font-size: 0.75rem;
  }

  /* Variações de Card */
  .media-card.card-list {
    flex-direction: row;
    max-width: none;
  }

  .media-card.card-list .card-thumbnail {
    flex: 0 0 200px;
    border-radius: 0.5rem 0 0 0.5rem;
  }

  .media-card.card-list .thumbnail-container {
    height: 120px;
  }

  .media-card.card-list .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .media-card.card-compact {
    max-width: 250px;
  }

  .media-card.card-compact .thumbnail-container {
    height: 140px;
  }

  .media-card.card-compact .card-body {
    padding: 0.75rem;
  }

  .media-card.card-compact .card-title {
    font-size: 0.9rem;
    -webkit-line-clamp: 1;
    line-clamp: 1;
  }

  .media-card.card-compact .card-description {
    -webkit-line-clamp: 2;
    line-clamp: 2;
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .media-card.card-list {
      flex-direction: column;
    }

    .media-card.card-list .card-thumbnail {
      flex: none;
      border-radius: 0.5rem 0.5rem 0 0;
    }

    .media-card.card-list .thumbnail-container {
      height: 180px;
    }

    .card-actions {
      flex-direction: column;
      align-items: stretch;
    }

    .card-actions .btn {
      width: 100%;
    }

    .card-footer {
      flex-direction: column;
      align-items: stretch;
      gap: 0.75rem;
    }

    .card-info {
      justify-content: center;
    }
  }

  @media (max-width: 576px) {
    .thumbnail-container {
      height: 160px;
    }

    .card-body {
      padding: 0.75rem;
    }

    .play-button {
      width: 50px;
      height: 50px;
      font-size: 1.25rem;
    }
  }

  /* Estados especiais */
  .media-card.processing {
    opacity: 0.7;
    pointer-events: none;
  }

  .media-card.processing .thumbnail-overlay {
    opacity: 1;
    background: rgba(0, 0, 0, 0.5);
  }

  .media-card.processing .play-button {
    background: rgba(var(--bs-warning-rgb), 0.9);
  }

  .media-card.processing .play-button i:before {
    content: "\f110";
    animation: fa-spin 2s infinite linear;
  }

  .media-card.error {
    border-color: var(--bs-danger);
  }

  .media-card.error .thumbnail-overlay {
    background: rgba(var(--bs-danger-rgb), 0.1);
  }

  .media-card.selected {
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 2px rgba(var(--bs-primary-rgb), 0.25);
  }

  /* Animações */
  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
    100% {
      transform: scale(1);
    }
  }

  .media-card.new {
    animation: pulse 2s ease-in-out;
  }

  /* Modo escuro */
  @media (prefers-color-scheme: dark) {
    .media-card {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .card-title {
      color: #ffffff;
    }

    .card-description {
      color: #b0b0b0;
    }

    .duration-badge {
      background: rgba(255, 255, 255, 0.2);
    }
  }
</style>

<script>
  // Funções do card
  function viewFile(id) {
    // Navegar para a página de detalhes
    window.router.navigate(`/detalhes/${id}`);
  }

  function addToPlaylist(id) {
    // Implementar adição à playlist
    console.log("Adicionar à playlist:", id);
    // Aqui você pode abrir um modal ou navegar para seleção de playlist
  }

  function downloadFile(id) {
    // Implementar download
    console.log("Download file:", id);
    // Simular download
    const event = new CustomEvent("file-download", { detail: { id } });
    document.dispatchEvent(event);
  }

  function shareFile(id) {
    // Implementar compartilhamento
    console.log("Share file:", id);
    if (navigator.share) {
      navigator.share({
        title: "Compartilhar arquivo",
        text: "Confira este arquivo no ISPMedia",
        url: `${window.location.origin}/detalhes/${id}`,
      });
    } else {
      // Fallback para copiar link
      const url = `${window.location.origin}/detalhes/${id}`;
      navigator.clipboard.writeText(url).then(() => {
        showAlert("Link copiado para a área de transferência!", "success");
      });
    }
  }

  function deleteFile(id) {
    // Implementar exclusão
    console.log("Delete file:", id);
    if (
      confirm(
        "Tem certeza que deseja excluir este arquivo? Esta ação não pode ser desfeita."
      )
    ) {
      // Simular exclusão
      const event = new CustomEvent("file-delete", { detail: { id } });
      document.dispatchEvent(event);
      showAlert("Arquivo excluído com sucesso!", "success");
    }
  }

  // Função para renderizar card com dados
  function renderCard(data, template = "default") {
    const cardElement = document.createElement("div");
    cardElement.className = "col-12 col-sm-6 col-md-4 col-lg-3";

    // Adicionar classes baseadas no template
    let cardClass = "media-card glass-card h-100";
    if (template === "list") cardClass += " card-list";
    if (template === "compact") cardClass += " card-compact";

    cardElement.innerHTML = `
        <div class="${cardClass}" data-file-id="${data.id}">
            <div class="card-thumbnail">
                <div class="thumbnail-container">
                    <img src="${
                      data.thumbnail ||
                      "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1lZGlhPC90ZXh0Pjwvc3ZnPg=="
                    }" alt="${
      data.title
    }" class="thumbnail-image" loading="lazy">
                    <div class="thumbnail-overlay">
                        <div class="play-button" onclick="viewFile('${
                          data.id
                        }')">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="duration-badge">${
                          data.duration || "0:00"
                        }</div>
                    </div>
                </div>
            </div>
            
            <div class="card-body">
                <div class="card-header-info">
                    <h5 class="card-title">${data.title}</h5>
                    <div class="card-meta">
                        <small class="text-muted">
                            <i class="fas fa-calendar-alt me-1"></i>
                            ${data.date || "N/A"}
                        </small>
                        <small class="text-muted ms-2">
                            <i class="fas fa-eye me-1"></i>
                            ${data.views || 0}
                        </small>
                    </div>
                </div>
                
                <div class="card-content">
                    <p class="card-description">${
                      data.description || "Sem descrição"
                    }</p>
                    
                    <div class="card-tags">
                        ${(data.tags || [])
                          .map(
                            (tag) =>
                              `<span class="badge bg-primary bg-opacity-20 text-primary">${tag}</span>`
                          )
                          .join("")}
                    </div>
                </div>
                
                <div class="card-footer">
                    <div class="card-actions">
                        <button class="btn btn-outline-primary btn-sm" onclick="viewFile('${
                          data.id
                        }')">
                            <i class="fas fa-eye me-1"></i>
                            Visualizar
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="addToPlaylist('${
                                  data.id
                                }')">
                                    <i class="fas fa-plus me-2"></i>Adicionar à Playlist
                                </a></li>
                                <li><a class="dropdown-item" href="#" onclick="downloadFile('${
                                  data.id
                                }')">
                                    <i class="fas fa-download me-2"></i>Download
                                </a></li>
                                <li><a class="dropdown-item" href="#" onclick="shareFile('${
                                  data.id
                                }')">
                                    <i class="fas fa-share me-2"></i>Compartilhar
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteFile('${
                                  data.id
                                }')">
                                    <i class="fas fa-trash me-2"></i>Excluir
                                </a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="card-info">
                        <small class="text-muted">
                            <i class="fas fa-hdd me-1"></i>
                            ${data.size || "N/A"}
                        </small>
                        <small class="text-muted ms-2">
                            <i class="fas fa-film me-1"></i>
                            ${data.quality || "N/A"}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    `;

    return cardElement;
  }

  // Exportar funções para uso global
  window.MediaCard = {
    render: renderCard,
    viewFile,
    addToPlaylist,
    downloadFile,
    shareFile,
    deleteFile,
  };
</script>
