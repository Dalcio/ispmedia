<nav class="navbar glass">
    <div class="navbar-container">
        <div class="navbar-brand">
            <a href="#" data-route="/" class="brand-link">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="2" width="28" height="28" rx="6" fill="#1F7AE0"/>
                    <path d="M8 12L16 8L24 12V24L16 20L8 24V12Z" fill="white"/>
                </svg>
                <span class="brand-text">ISPMedia</span>
            </a>
        </div>
        
        <div class="navbar-menu">
            <a href="#" data-route="/" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                <span>Início</span>
            </a>
            
            <a href="#" data-route="/dashboard" class="nav-item auth-only">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="9" x2="9" y2="15"/>
                    <line x1="15" y1="9" x2="15" y2="15"/>
                </svg>
                <span>Dashboard</span>
            </a>
            
            <a href="#" data-route="/files" class="nav-item auth-only">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                <span>Ficheiros</span>
            </a>
            
            <a href="#" data-route="/admin" class="nav-item admin-only">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m15.5-6.5L16 12l4.5 4.5M8 12L3.5 7.5M3.5 16.5L8 12"/>
                </svg>
                <span>Admin</span>
            </a>
        </div>
        
        <div class="navbar-actions">
            <button class="btn btn-primary btn-sm auth-only" onclick="Functions.loadModal('app/files/modal-upload.html', 'modal-upload')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7,10 12,15 17,10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Upload
            </button>
            
            <div class="user-menu auth-only">
                <button class="user-button">
                    <div class="user-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <span class="user-name">Utilizador</span>
                </button>
                
                <div class="user-dropdown">
                    <a href="#" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Perfil
                    </a>
                    <a href="#" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m15.5-6.5L16 12l4.5 4.5M8 12L3.5 7.5M3.5 16.5L8 12"/>
                        </svg>
                        Configurações
                    </a>
                    <hr class="dropdown-divider">
                    <a href="#" class="dropdown-item" data-action="logout">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Sair
                    </a>
                </div>
            </div>
            
            <button class="btn btn-primary btn-sm guest-only" onclick="Functions.loadModal('app/home/modal-auth.html', 'modal-auth')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10,17 15,12 10,7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                </svg>
                Entrar
            </button>
        </div>
        
        <button class="mobile-menu-toggle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
    </div>
</nav>

<script>
// Configuração da navbar
document.addEventListener('DOMContentLoaded', function() {
    const navbar = document.querySelector('.navbar');
    const userButton = document.querySelector('.user-button');
    const userDropdown = document.querySelector('.user-dropdown');
    const mobileToggle = document.querySelector('.mobile-menu-toggle');
    const navbarMenu = document.querySelector('.navbar-menu');
    
    // Toggle do dropdown do utilizador
    if (userButton && userDropdown) {
        userButton.addEventListener('click', function(e) {
            e.stopPropagation();
            userDropdown.classList.toggle('active');
        });
        
        // Fecha dropdown ao clicar fora
        document.addEventListener('click', function() {
            userDropdown.classList.remove('active');
        });
    }
    
    // Toggle do menu mobile
    if (mobileToggle && navbarMenu) {
        mobileToggle.addEventListener('click', function() {
            navbarMenu.classList.toggle('active');
        });
    }
    
    // Atualiza visibilidade baseado na autenticação
    function updateNavbarVisibility() {
        const isAuthenticated = Session.isAuthenticated();
        const user = Session.getUser();
        
        // Mostra/esconde elementos baseado na autenticação
        document.querySelectorAll('.auth-only').forEach(element => {
            element.style.display = isAuthenticated ? 'flex' : 'none';
        });
        
        document.querySelectorAll('.guest-only').forEach(element => {
            element.style.display = isAuthenticated ? 'none' : 'flex';
        });
        
        // Mostra/esconde elementos admin
        document.querySelectorAll('.admin-only').forEach(element => {
            element.style.display = (isAuthenticated && user && user.role === 'admin') ? 'flex' : 'none';
        });
        
        // Atualiza nome do utilizador
        if (isAuthenticated && user) {
            document.querySelectorAll('.user-name').forEach(element => {
                element.textContent = user.name;
            });
        }
    }
    
    // Atualiza na inicialização
    updateNavbarVisibility();
    
    // Escuta mudanças de autenticação
    window.addEventListener('auth-changed', updateNavbarVisibility);
});
</script>

<style>
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    z-index: 1000;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.navbar-container {
    max-width: 1200px;
    margin: 0 auto;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--spacing-lg);
}

.navbar-brand .brand-link {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    color: var(--text-primary);
    font-weight: var(--font-weight-semibold);
    font-size: 1.25rem;
    text-decoration: none;
}

.navbar-menu {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.nav-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--border-radius-sm);
    transition: all var(--transition-fast);
    font-weight: var(--font-weight-medium);
}

.nav-item:hover,
.nav-item.active {
    color: var(--primary-blue);
    background: rgba(31, 122, 224, 0.1);
}

.navbar-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.user-menu {
    position: relative;
}

.user-button {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    background: none;
    border: none;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.user-button:hover {
    background: rgba(255, 255, 255, 0.1);
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--gray-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: var(--spacing-sm);
    background: var(--white);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-md);
    box-shadow: 0 8px 24px var(--shadow-medium);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
}

.user-dropdown.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--text-primary);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.dropdown-item:hover {
    background: var(--light-gray);
}

.dropdown-divider {
    margin: var(--spacing-xs) 0;
    border: none;
    border-top: 1px solid var(--border-light);
}

.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-sm);
}

@media (max-width: 768px) {
    .navbar-container {
        padding: 0 var(--spacing-md);
    }
    
    .navbar-menu {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: var(--white);
        flex-direction: column;
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border-light);
        box-shadow: 0 4px 12px var(--shadow-medium);
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: all var(--transition-medium);
    }
    
    .navbar-menu.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
    }
    
    .nav-item {
        width: 100%;
        justify-content: flex-start;
        padding: var(--spacing-md);
    }
    
    .mobile-menu-toggle {
        display: block;
    }
    
    .navbar-actions {
        gap: var(--spacing-sm);
    }
    
    .user-name {
        display: none;
    }
}
</style>
